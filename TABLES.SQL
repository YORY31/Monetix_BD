---TABLES OF DB
CREATE DATABASE MONETIX_APP;

USE MONETIX_APP;

----FIRST TABLE

CREATE TABLE USERS(
ID_USER INT IDENTITY (1,1) PRIMARY KEY,
NAME_USER NVARCHAR(100) not null ,
LAST_NAME NVARCHAR(100) NOT NULL,
EMAIL NVARCHAR (255) UNIQUE NOT NULL,
PASSWORDHASH NVARCHAR(255) NOT NULL,
CREATEADT DATETIME DEFAULT GETDATE(),
LAST_LOGIN DATETIME DEFAULT GETDATE(),
ISVERIFICATED BIT DEFAULT 0,
PASSWORD_RESET NVARCHAR(255),
VERIFICATION_TOKEN NVARCHAR(255),
TOKEN_EXPIRATION DATETIME

);

CREATE TABLE CATEGORIES(
CATEGORY_ID INT IDENTITY(1,1) PRIMARY KEY,
NAME_CATEGORY NVARCHAR(100) NOT NULL,
TYPE NVARCHAR(50) CHECK (TYPE IN ('Income','Expense')) not null,
CREATEADT DATETIME DEFAULT GETDATE()

);

CREATE TABLE TRANSACTIONS (
TRANSACTIONID INT IDENTITY(1,1) PRIMARY KEY,
USERID INT NOT NULL,
CATEGORYID INT NOT NULL,
TITLE NVARCHAR (100) NOT NULL,
DESCRIPCION NVARCHAR(255),
AMOUNT DECIMAL(18,2) NOT NULL,
IS_ACTIVE BIT DEFAULT 1,
TRANSACTIONDATE DATETIME DEFAULT GETDATE() NOT NULL,
CREATEADT DATETIME DEFAULT GETDATE()

FOREIGN KEY  (USERID) REFERENCES USERS (ID_USER),
FOREIGN KEY  (CATEGORYID) REFERENCES CATEGORIES (CATEGORY_ID)
);
CREATE TABLE BUDGETS(
BUDGETID INT IDENTITY(1,1) PRIMARY KEY,
USERID INT NOT NULL ,
CATEGORYID INT NOT NULL,
MAXAMOUNT DECIMAL (18,2) NOT NULL,
STARTDATE DATETIME NOT NULL,
ENDDATE DATETIME NOT NULL,
CREATEADT DATETIME DEFAULT GETDATE(),
IS_ACTIVE BIT DEFAULT 1,
FOREIGN KEY  (USERID) REFERENCES USERS (ID_USER),
FOREIGN KEY  (CATEGORYID) REFERENCES CATEGORIES (CATEGORY_ID)
);

CREATE TABLE SAVINGS_GOALS(
GOAL_ID INT IDENTITY(1,1) PRIMARY KEY,
USERID INT NOT NULL,
NAME_GOALS NVARCHAR(100)  NOT NULL,
TARGETAMOUT DECIMAL(18,2) NOT NULL,
SAVEDAMOUNT DECIMAL DEFAULT 0,
DUEDATE DATETIME,
CREATEADT DATETIME DEFAULT GETDATE(),
IS_ACHIEVED BIT DEFAULT 0, --THE GOAL IS NOT COMPLETE
FOREIGN KEY  (USERID) REFERENCES USERS (ID_USER)

);
CREATE CLUSTERED INDEX IDX_USERS_ID ON USERS (ID_USER);
CREATE NONCLUSTERED INDEX IDX_USERE_EMAIL ON USERS (EMAIL);

CREATE CLUSTERED INDEX IDX_TRANSACTIONS_ID ON TRANSACTIONS (TRANSACTIONID);
CREATE NONCLUSTERED INDEX IDX_TRACSACTIONS_USER ON TRANSACTIONS (USERID);
CREATE NONCLUSTERED INDEX IDX_TRASACCIONS_CATEGORY ON TRANSACTIONS (CATEGORYID);

CREATE CLUSTERED INDEX IDX_BUDGETS_ID ON BUDGETS (BUDGETID);
CREATE NONCLUSTERED INDEX IDX_BUDGETS_USER_CATEGORY ON BUDGETS (USERID, CATEGORYID);

CREATE CLUSTERED INDEX IDX_SAVINGS_GOALS_ID ON SAVINGS_GOALS (GOAL_ID)
CREATE NONCLUSTERED INDEX IDX_SAVINGS_USER ON SAVINGS_GOALS (USERID);

